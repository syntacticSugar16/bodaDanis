<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/img/Logo-Boda-danis-03.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/style.css">
    <title>D & D</title>
</head>
<body id="parent">
    <audio id="audio" controls loop id="audio">
        <source type="audio/mp3" src="Capuchino de Amor.mp3">
    </audio>
    <div>
        <div class="letter-container">
            <p style="font-size: 1rem;" class="indicacion"><b>Click para abrir</b></p>
            <div class="envelope-wrapper">
                <div class="envelope">
                    <div class="front flap"></div>
                    <div class="back flap"></div>
                    <div class="letter"></div>
                    <div class="left flap"></div>
                    <div class="right flap"></div>
                    <div class="bottom flap">
                        <img src="img/logo boda danis-03.png" alt="">
                    </div>
                    <div class="top flap">
                        <hr class="letter-left">
                        <hr class="letter-right">
                    </div>
                </div>
            </div>
        </div>

        <div class="invitacion">
            <div class="fab-container">
                <button id="mute-toggle-button" class="fab-button">
                    <!-- Icono inicial: Volumen desactivado (muted) -->
                    <i class="material-icons">volume_off</i>
                </button>
            </div>
            <section id="titulo">
                <div id="bg-titulo"></div>
                <div class="container hidden contenido">
                    <h2>Nuestra Boda</h2>
                    <img src="img/logo boda danis-03.png" alt="">
                    <h3>Daniel y Daniela</3>
                </div>
            </section>

            <section class="frase">
                <div class="container hidden frase">
                    <img src="img/archery.gif" alt="Imagen de arco de amor">
                    <p>Nuestro amor está por iniciar un nuevo capítulo.</p>
                </div>
            </section>

            <section id="time">  
                <div class="wrapper-outer">
                    <div class="wrapper">
                        <div id="bg-time"></div>
                    </div>
                </div>

                <div>
                    <svg class="fill-1" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>
                    <h2 class="container hidden">Sábado 8</h2>
                        <div id="fecha">
                            <p class="container hidden">Noviembre</p>
                            <p class="container hidden"> 16:00 Hrs</p>
                        </div>
                    <h2 class="container hidden">Faltan: </h2>
                    <div class="container hidden" id="time-counter"></div>
                </div>
                    
            </section>

            <section class="bendicion">
                <div class="fondo-bendicion"> 
                    <div class="hidden">
                        <h2 class="hidden">Con la bendición de <br> nuestros padres.</h2>

                        <h3><b>Daniel Corona</b></h3>
                        <h5>Sandra Trujillo Hernández</h5>
                        <h5>Silverio Corona Gallegos</h5>

                        <hr>

                        <h3><b>Daniela Peña</b></h3>
                        <h5>Dulce María Ramón Gamboa</h5>
                        <h5>Mario Sánchez Ramos</h5>
                        
                    </div>
                </div>
            </section>

            <section class="padrinos">
                <div class="fondo-padrinos"> 
                    <div class="hidden">
                        <h2 class="hidden">Padrinos</h2>
                    </div>

                    <div class="hidden">
                        <img src="img/Texto/9.png" alt="">
                        <p>Arras</p>
                        <h5>Matrimonio Ureña Andrade</h5>
                    </div>

                    <div class="vertical-line hidden"></div>
                    
                    <div class="hidden">
                        <img src="img/Texto/10.png" alt="">
                        <p>Anillos</p>
                        <h5>Angelina Gamboa Contreras</h5>
                    </div>

                    <div class="vertical-line hidden"></div>

                    <div class="hidden">
                        <img src="img/Texto/11.png" alt="">
                        <p>Lazo</p>
                        <h5>Matrimonio Juan Moscoso</h5>
                    </div>

                    <div class="vertical-line hidden"></div>

                    <div class="hidden">
                        <img src="img/Texto/12.png" alt="">
                        <p>Cojines</p>
                        <h5>Linda Araceli Lestegast Bello</h5>
                    </div>

                    <div class="vertical-line hidden"></div>

                    <div class="hidden">
                        <img src="img/Texto/13.png" alt="">
                        <p>Biblia</p>
                        <h5>Rocío Amisadai López Moscoso</h5>
                    </div>

                </div>
            </section>

            <section id="itinerario">
                
                <div class="fondo-itinerario">
                    <div class="container">
                        <h2 class="hidden">Itinerario</h2>
                        <div class="elem-itinerario-right hidden">
                            <p>Bienvenida <br>02:30 - 03:30 p.m.</p>
                            <img src="img/Texto/5.png" alt="Imagen de llegada">
                        </div>

                        <div class="elem-itinerario-left hidden">
                            <span>Al iniciar la ceremonia, se cerrarán las puertas para preservar la solemnidad del momento.</span>
                            <div class="linea-vertical"></div>
                            <b></b>
                        </div>

                        <div class="elem-itinerario-left hidden">
                            <b></b>
                            <img src="img/Texto/1.png" alt="Imagen de Ceremonia">
                            <p>Ceremonia <br>04:00 p.m.</p>
                        </div>

                        <div class="elem-itinerario-right hidden">
                            <b></b>
                            <div class="linea-vertical"></div>
                            <span>Concluida la ceremonia, abriremos nuevamente las puertas para dar inicio a la recepción y continuar la celebración.</span>
                        </div>

                        <div class="elem-itinerario-right hidden">
                            <p>Celebración <br>06:00 p.m.</p>
                            <img src="img/Texto/3.png" alt="Imagen de celebración"> 
                        </div>

                        <div class="sep-itinerario hidden">
                            <b></b>
                            <div class="linea-vertical"></div>
                            <b></b>
                        </div>

                        <div class="elem-itinerario-left hidden">
                            <b></b>
                            <img src="img/Texto/2.png" alt="Imagen de fotos y regalos">
                            <p>Pastel y fotos <br>08:00 p.m.</p>
                        </div>

                        <div class="sep-itinerario hidden">
                            <b></b>
                            <div class="linea-vertical"></div>
                            <b></b>
                        </div>

                        <div class="elem-itinerario-right hidden">
                            <p>Ramo <br>09:30 p.m.</p>
                            <img src="img/Texto/6.png" alt="Imagen de fotos y regalos">
                        </div>

                        <div class="sep-itinerario hidden">
                            <b></b>
                            <div class="linea-vertical"></div>
                            <b></b>
                        </div>

                        <div class="elem-itinerario-left hidden">
                            <b></b>
                            <img src="img/Texto/7.png" alt="Imagen de clausura">
                            <p>Fuegos Artificiales <br>10:00 p.m.</p> 
                        </div>

                        <div class="sep-itinerario hidden">
                            <b></b>
                            <div class="linea-vertical"></div>
                            <b></b>
                        </div>

                        <div class="elem-itinerario-right hidden">
                            <p>¡Continúa la fiesta!<br>10:30 p.m.</p>
                            <img src="img/Texto/8.png" alt="Imagen de clausura"> 
                        </div>

                        <div class="elem-itinerario hidden">
                            <b></b>
                            
                            <div class="linea-vertical"></div>
                        </div>
                    </div>

                </div>
            </section>

            <section id="date-info">
                <div>
                    <h2 class="show-right">Ubicación</h2>
                    <svg class="fill-1" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>        
                </div>
                
                <div id="date-grids" class="container hidden">
                    <div>
                        
                        <div id="date-container">
                            <div>
                                <img src="img/place.gif" alt="">
                                <p><b>Jardin y Lago</b></p>
                                <h4>Quinta "Las Palmas"</h4>
                                <p>Francisco I Madero 79, <br>Coyol, 91780 <br>Veracruz, Ver.</p>
                                <div class="btnInfo">
                                    <a href="https://maps.app.goo.gl/YtNhscYzwDHUXDaq6" target="_blank">Ver mapa</a>
                                </div>
                            </div>
                            <img src="img/ubicacion.jpeg" alt="Imagen de ubicacion">
                        </div>
                        
                    </div>
                </div>
  
            </section>

            <section id="regalos">
                <svg class="fill-2" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>
                
                <div class="container hidden">
                    <h2>Mesa de regalos</h2>
                    <p>Haz click en cada opción.</p>
                    <p>Nuestro mejor regalo es tu compañía este día, pero agradecemos si gustas tener un detalle con nosotros.
                    </p>
                    <p>Aquí te dejamos algunas opciones, o también puedes darnos un apoyo monetario que será destinado para hacer realidad nuestra luna de miel soñada.</p>
                </div>

                    <div class="opciones-regalo container hidden">
                        <div style="display: flex;">
                            <div>
                                <a href="https://www.amazon.com.mx/hz/wishlist/ls/2SK35ZGKMWMNA?ref_=wl_share" target="_blank">
                                    <img src="img/amazon.png" alt="Icono de amazon" style="width: 50%;">
                                    <p>Amazon</p>
                                </a>
                            </div>

                            <div>
                                <a href="https://mesaderegalos.liverpool.com.mx/milistaderegalos/51607591" target="_blank">
                                    <img src="img/liverpool.png" alt="Icono de liverpulgas" style="width: 50%;">
                                    <p>Liverpool</p>
                                </a>
                            </div>
                        </div>

                        <div>
                            <img src="img/sobres.png" alt="Icono de lluvia de sobres">
                            <p>Lluvia de sobres</p>
                        </div>
                    </div>

                    
            </section>

            <section id="vestimenta">
                <div>
                    <h2>Código de vestimenta</h2>
                    <svg class="fill-1" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>
                </div>
                
                <div class="container hidden">
                    <h4>Formal</h4>
                    <p>Queremos que cada uno de ustedes se sienta especial y luzca espectacular en nuestro día.</p>
                    <div>
                        <img src="img/tuxedo.gif" alt="" id="traje">
                        <img src="img/dress.gif" alt="">
                    </div>
                    <p>Evita los siguientes colores</p>
                    <hr>
                    <img src="img/paleta.png" alt="Imagen de paleta de colores">
                    <hr>
                    <h4>Inspiración</h4>
                    <a data-pin-do="embedBoard" data-pin-scale-height="240" data-pin-scale-width="90" href="https://mx.pinterest.com/danipr791/c%C3%B3digo-de-vestimenta/"></a>
                </div>
            </section>

            <section id="mensaje">
                <div>
                    <h2>Dejanos un mensaje</h2>
                    <svg class="fill-1" fill="" viewBox="0 0 1439 45"><path d="M0,0 L0,45 C0,45 359,18 719,18 C1079,18 1439,45 1439,45 L1439,0 Z" fill=""></path></svg>

                    <div class="container-wrapper hidden">
                        <form id="message-form">
                            <div class="form-group">
                                <label for="name-input">Tu Nombre</label>
                                <input id="name-input" type="text" required>
                            </div>
                            <div class="form-group">
                                <label for="message-input">Tu Mensaje</label>
                                <textarea id="message-input" rows="4" required></textarea>
                            </div>
                            <button class="btnInfo" type="submit">
                                Enviar Mensaje
                            </button>
                        </form>

                        <div class="divider"></div>

                        <!-- Indicador de carga -->
                        <div id="loading-indicator">
                            Cargando mensajes...
                        </div>

                        <!-- Contenedor donde se mostrarán los mensajes -->
                        <div id="messages-container">
                            <!-- Los mensajes se cargarán aquí dinámicamente -->
                        </div>
                    </div>
                </div>
            </section>

            <section id="galeria">
                <div>
                    <h2>Galería de fotos</h2>
                    <svg class="fill-1" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>        
                </div>
                <div class="hidden">
                    <div class="container">

                    <div class="carousel">
                        <a class="carousel-item" href="#one!"><img src="img/fotos-danis/WhatsApp Image 2025-07-12 at 6.05.04 PM (1).jpeg"></a>
                        <a class="carousel-item" href="#two!"><img src="img/fotos-danis/WhatsApp Image 2025-07-12 at 6.05.02 PM.jpeg"></a>
                        <a class="carousel-item" href="#three!"><img src="img/fotos-danis/WhatsApp Image 2025-07-12 at 6.05.05 PM (2).jpeg"></a>
                        <a class="carousel-item" href="#four!"><img src="img/fotos-danis/WhatsApp Image 2025-07-12 at 6.05.03 PM (3) - copia.jpeg"></a>
                        <a class="carousel-item" href="#five!"><img src="img/fotos-danis/WhatsApp Image 2025-07-12 at 6.05.02 PM (2) - copia.jpeg"></a>
                    </div>

                    <p>Conoce un poco de nuestra historia.</p>
                    <img src="img/swipe-left.gif" alt="Gif de deslizar a la derecha" class="gift">

                    </div>
                    
                    <div class="cards">

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h1.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">¿Ensalada?<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">¿Ensalada?<i class="material-icons right">close</i></span>
                                <p>En este tiempo aprendí que las mujeres solo las primeras cinco citas se reservan comiendo una ensalada y agüita de chía con limón.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h2.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Primer viaje<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Primer viaje<i class="material-icons right">close</i></span>
                                <p>El primer viaje juntos siempre es especial, y más cuando ese viaje conecta con los mejores momentos en la vida de la persona que amas.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h3.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Unos moquitos<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Unos <br>moquitos<i class="material-icons right">close</i></span>
                                <p>Quédate con quién te saque un moco para después comerselo con sal y limón.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h4.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Primera cita<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Primera cita<i class="material-icons right">close</i></span>
                                <p>Primera cita de novios, día especial cumpliendo el sueño de manejar un barco y con el amor de mi vida en mi tripulación.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h5.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Primera navidad<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Primera <br>navidad<i class="material-icons right">close</i></span>
                                <p>La primer navidad del resto de nuestras vidas juntos, recordando que Jesús vino al mundo para darnos paz, amor y salvación. En esta foto tenemos paz, amor y salvación.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h6.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Arriba las <br>Chivas<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Arriba las chivas<i class="material-icons right">close</i></span>
                                <p>Él diría que con el amor de su vida y pensarían que soy yo, pero es que trae puesta la de sus amadas Chivas del Guadalajara.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h7.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">La propuesta<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">La propuesta<i class="material-icons right">close</i></span>
                                <p>Las personas siempre tenemos espectativas tan altas que olvidamos que con tan poco podemos ser felices... Y como dice Daniel nuestros mejores o días más especiales siempre han sido junto a Dios sirviéndole. <br>24/Diciembre/2024 <br>Debíamos participar y servir en la iglesia, pero antes...llegamos ya comprometidos el uno con el otro.❤️</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h8.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Cita #?????<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Cita #?????<i class="material-icons right">close</i></span>
                                <p>Cita # desconocida... <br>
                                Pero, "Viene a mi memoria:" <br>
                                Que en nuestra primer cita le dije: las personas nos podemos conocer incluso por como somos al comer ... Y él quiso continuar hasta hoy conmigo.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h9.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Una cenita<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Una cenita<i class="material-icons right">close</i></span>
                                <p>Cruzamos casi un río para llegar a cenar; Amo tus locuras aunque no las comprenda, amo el amor que me das porque fue lo que le pedí a Dios tener en mi vida. Amo que me consientas también.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="img/historias/h10.jpeg">
                            </div>
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4">Ay el amor<i class="material-icons right">open_in_full</i></span>
                            </div>
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4">Ay el amor<i class="material-icons right">close</i></span>
                                <p>"Felicidad" <br>
                                "La persona indicada" <br>
                                "¡¡Vale todo!! poner en Dios los deseos del corazón"</p>
                            </div>
                        </div>

                    </div>
                </div>
                
            </section>
                <div class="aviso">
                    <svg class="fill-2" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>
                    <div class="container hidden">
                        <p>Para que todos puedan relajarse y disfrutar, hemos decidido hacer nuestra boda solo para adultos.</p>
                        <p>Agradecemos por los arreglos que haces para asistir <b>SIN NIÑOS.</b></p>
                    </div>
                </div>
            <section id="asistencia">
                
                <svg class="fill-1" fill="" viewBox="0 0 1439 60"><path d="M0,0 L0,60 C0,60 359,18 719,18 C1079,18 1439,60 1439,60 L1439,0 Z" fill=""></path></svg>

                <div class="container hidden">
                    <h2>Asistencia</h2>
                    <p>No podemos imaginar nuestra boda sin ti, por eso queremos asegurarnos de que estarás ahí para compartir esta felicidad con nosotros.</p>
                    <p>¿Contamos contigo?</p>
                    <div class="btnInfo">
                        <a href="https://wa.me/522291438773?text=¡Hola gracias por la invitación !. Confirmo mi asistencia a tu boda." target="_blank" ><img src="/img/whatsapp-fill.svg" alt="Icono de whatsapp"> Confirmar asistencia</a>
                    </div>
                    <p><b>Recuerda tienes hasta el 30 de septiembre para confirmar tu asistencia, de lo contrario daremos por hecho que no podrás acompañarnos.</b></p>
                </div>
            </section>

        </div>
    </div>

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="js/main.js"></script>
    <script type="text/javascript" async defer src="//assets.pinterest.com/js/pinit.js"></script>
    <script src="js/alert.js"></script>
    <script src="/js/simplyCountdown.min.js"></script>
    <script src="/js/countdown.js"></script>
    <script type="module">
        // Importa las funciones necesarias de Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // Configuración de Firebase: Intenta usar __firebase_config del entorno, si no, usa la configuración por defecto.
        const firebaseConfig = typeof __firebase_config !== 'undefined'
            ? JSON.parse(__firebase_config)
            : {
                apiKey: "AIzaSyAIpYR5IfMLKJpogfLYMQ375PnEo9HMCYc",
                authDomain: "boda-4d986.firebaseapp.com",
                databaseURL: "https://boda-4d986-default-rtdb.firebaseio.com",
                projectId: "boda-4d986",
                storageBucket: "boda-4d986.firebasestorage.app",
                messagingSenderId: "433750913571",
                appId: "1:433750913571:web:06585ae59374f87f49f796",
                measurementId: "G-8VL86NR41N"
            };

        // Inicializa la aplicación Firebase
        const app = initializeApp(firebaseConfig);
        // Obtiene la instancia de la base de datos en tiempo real
        const db = getDatabase(app);
        // Obtiene la instancia de autenticación
        const auth = getAuth(app);

        let userId = ''; // Variable para almacenar el ID de usuario

        // Elementos del DOM
        const messageForm = document.getElementById('message-form');
        const nameInput = document.getElementById('name-input');
        const messageInput = document.getElementById('message-input');
        const messagesContainer = document.getElementById('messages-container');
        const loadingIndicator = document.getElementById('loading-indicator');

        /**
         * Función para inicializar Firebase y configurar los listeners.
         * Se ejecuta cuando la ventana ha cargado completamente.
         */
        window.onload = async () => {
            try {
                // Intenta iniciar sesión con un token personalizado si está disponible (entorno Canvas)
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    // Si no hay token, inicia sesión de forma anónima
                    await signInAnonymously(auth);
                }
                // Obtiene el ID de usuario actual o genera uno si es necesario
                userId = auth.currentUser?.uid || crypto.randomUUID();
                console.log("Firebase inicializado y autenticado. ID de usuario:", userId);

                // Configura el listener de la base de datos en tiempo real una vez autenticado
                setupRealtimeListeners();
            } catch (error) {
                console.error("Error durante la inicialización o autenticación de Firebase:", error);
                loadingIndicator.textContent = 'Error al inicializar la aplicación. Por favor, recarga la página.';
                loadingIndicator.classList.add('red-text'); // Clase de Materialize para texto rojo
            }
        };

        /**
         * Maneja el envío del formulario para guardar un nuevo mensaje en Firebase.
         */
        messageForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Evita el envío por defecto del formulario

            const name = nameInput.value.trim();
            const message = messageInput.value.trim();

            if (name && message) {
                try {
                    // Define la referencia a la colección de mensajes en la base de datos.
                    // Se usa __app_id para crear una ruta única por aplicación, si está disponible.
                    const messagesRef = ref(db, `messages/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}`);

                    // Empuja un nuevo mensaje a la base de datos con nombre, mensaje y marca de tiempo
                    await push(messagesRef, {
                        name: name,
                        message: message,
                        timestamp: Date.now() // Guarda la marca de tiempo para ordenar
                    });

                    // Limpia los campos del formulario después de enviar
                    nameInput.value = '';
                    messageInput.value = '';
                    // Re-inicializa los campos de Materialize para que las etiquetas floten correctamente
                    M.updateTextFields();
                    M.textareaAutoResize(messageInput);
                } catch (error) {
                    console.error("Error al enviar el mensaje:", error);
                    // Muestra un mensaje de error al usuario (podrías usar un modal personalizado)
                    messagesContainer.innerHTML = `<p class="red-text">Error al enviar el mensaje: ${error.message}</p>`;
                }
            } else {
                // Informa al usuario que ambos campos son obligatorios
                messagesContainer.innerHTML = `<p class="orange-text">Por favor, escribe tu nombre y un mensaje.</p>`;
            }
        });

        /**
         * Configura el listener en tiempo real para la colección de mensajes.
         * Se activa cada vez que hay cambios en la base de datos.
         */
        function setupRealtimeListeners() {
            // Define la referencia a la colección de mensajes
            const messagesRef = ref(db, `messages/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}`);

            // onValue escucha los cambios en tiempo real
            onValue(messagesRef, (snapshot) => {
                loadingIndicator.style.display = 'none'; // Oculta el indicador de carga
                messagesContainer.innerHTML = ''; // Limpia los mensajes anteriores

                if (snapshot.exists()) {
                    const data = snapshot.val(); // Obtiene los datos del snapshot
                    const messagesArray = [];

                    // Convierte el objeto de datos en un array para facilitar la iteración y el ordenamiento
                    for (let key in data) {
                        messagesArray.push({ id: key, ...data[key] });
                    }

                    // Ordena los mensajes por marca de tiempo (los más antiguos primero)
                    messagesArray.sort((a, b) => b.timestamp - a.timestamp); // CAMBIO AQUÍ: Orden descendente

                    // Itera sobre los mensajes y los añade al contenedor
                    messagesArray.forEach((msg) => {
                        const messageElement = document.createElement('div');
                        // Aplica las clases de Materialize para una tarjeta
                        messageElement.className = 'col s12 m6 l4 message-card card blue-grey lighten-5'; // Clases de Materialize para responsividad y estilo de tarjeta
                        messageElement.innerHTML = `
                            <div class="card-content black-text">
                                <span class="card-title" style="font-weight: bold; color: #3f51b5;">${msg.name}:</span>
                                <p>${msg.message}</p>
                                <p class="right-align grey-text text-darken-1" style="font-size: 0.75rem; margin-top: 10px;">${new Date(msg.timestamp).toLocaleString()}</p>
                            </div>
                        `;
                        messagesContainer.appendChild(messageElement);
                    });
                } else {
                    // Si no hay mensajes, muestra un mensaje indicándolo
                    messagesContainer.innerHTML = '<p class="grey-text text-darken-1 center-align" style="padding: 20px 0;">No hay mensajes aún. ¡Sé el primero en escribir uno!</p>';
                }
            }, (error) => {
                // Manejo de errores al leer la base de datos
                console.error("Error al leer los mensajes:", error);
                loadingIndicator.textContent = 'Error al cargar mensajes. Por favor, verifica tu conexión.';
                loadingIndicator.classList.add('red-text');
            });
        }

    </script>
</body>

</html>





